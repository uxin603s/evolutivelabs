<template>
  <div id="purchase">
    <div class="purchase__title-wrapper">
      <h2 class="purchase__title">
        二步驟 <br />
        打造專屬殼
      </h2>
    </div>
    <!-- 手機殼顯示區 -->
    <div class="display__area">
      <section class="purchase__preview">
        <div class="purchase__preview-images-wrapper" v-if="deviceObject[selectDevice]">
          <img
            :src="deviceObject[selectDevice]['手機'].variants[phoneType].image"
            alt=""
            class="purchase__preview-image main"
          />
          <img
            :src="deviceObject[selectDevice]['外框'].variants[phoneColorType].image"
            alt=""
            class="purchase__preview-image sub case"
          />
          <img
            :src="deviceObject[selectDevice]['飾條'].variants[phoneColorType].image"
            alt=""
            class="purchase__preview-image sub rim "
            :class="modeType==0?'purchase__preview-image--backward ':'backplate'"
          />

          <img
            :src="deviceObject[selectDevice]['按鍵'].variants[phoneColorType].image"
            alt=""
            class="purchase__preview-image sub button"
          />
          <img
            :src="deviceObject[selectDevice]['背板'].variants[backType].image"
            alt=""
            class="purchase__preview-image sub "
            :class="modeType==1?'purchase__preview-image--backward':'backplate'"
          />
        </div>
        <div class="purchase__selector-wrapper phone">
          <div class="color-container">
            <p class="color-picker-title">裝置<br />顏色</p>
            <div class="normal color-picker color-picker--vertical" v-if="deviceObject[selectDevice]">
              <pre v-if="0" >{{deviceObject[selectDevice]['手機'].variants}}</pre>
              <div
              v-for="(item,index) in deviceObject[selectDevice]['手機'].variants"
              :key="index"
                class="color-picker--vertical__option active"
                @click="phoneType=index"
              >
                <div class="dot apple_graphite"></div>
              </div>

            </div>
          </div>
        </div>
        <div class="purchase__backplate-switch-wrapper">
          <div class="backplate-switch light">
            <section class="backplate-switch__common">
              <div class="backplate-switch__option" @click="modeType=0">
                <div
                  class="backplate-switch__checkbox backplate-switch__checkbox--active"
                ></div>
                <p class="backplate-switch__mode-name">背板模式</p>
              </div>
              <div class="backplate-switch__option" @click="modeType=1">
                <div class="backplate-switch__checkbox"></div>
                <p class="backplate-switch__mode-name">邊框模式</p>
              </div>
            </section>
          </div>
        </div>
      </section>
    </div>
    <!-- 型號/顏色顯示區 -->
    <div class="selection__area">
      <div class="selection__area__top">
        <div class="device__selector">
          <select name="" id="device" v-model="selectDevice">
            device
            <option
            v-for="(item,index) in deviceList"
            :key="index"
            :value="item"
            >{{item}}</option>
          </select>
        </div>
        <pre v-if="deviceObject[selectDevice] && 0">
        {{deviceObject[selectDevice]['透明背板'].variants[0].image}}
        {{deviceObject[selectDevice]['背板'].variants[2].image}}
        </pre>
        <div class="outward">
          <div class="option__block">
            <p class="option__title">手機殼顏色</p>
            <div class="icon"></div>
            <div v-if="deviceObject[selectDevice]">
              <button
              :key="index"
              v-for="(item,index) in deviceObject[selectDevice]['外框'].variants"
              @click="phoneColorType=index"
              >
                {{item.title}}
              </button>
            </div>
          </div>
          <div class="option__block">
            <p class="option__title">背板樣式</p>
            <div class="icon"></div>
            <div v-if="deviceObject[selectDevice]">
              <button
              :key="index"
              v-for="(item,index) in deviceObject[selectDevice]['背板'].variants"
              @click="backType=index"
              >
                <img width="100" :src="item.image">
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="checkout">
        <div class="checkout__detail">
          <p class="checkout__detail__info">產品包含:</p>
          <p class="checkout__detail__info">手機殼外框 (黑) x 1</p>
          <p class="checkout__detail__info">按鍵 (黑) x 3</p>
          <p class="checkout__detail__info">背板 (透明) x 1</p>
          <p class="checkout__detail__info">飾條 (黑) x 1</p>
        </div>
        <div class="checkout__button__block">
          <button class="checkout__btn" @click="addToCart">加入購物車</button>
          <p class="price">$800 TWD</p>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import axios from 'axios'
export default {
  components: {},
  props: {},
  data () {
    return {
      cartItems: [],
      product: {},
      deviceList: [],
      selectDevice: '',
      deviceObject: {},
      phoneType: 0,
      phoneColorType: 0,
      backType: 0,
      modeType: 0
    }
  },
  computed: {},
  mounted () {
    this.fetchProductData()
  },
  methods: {
    fetchProductData () {
      axios.get('http://localhost:3000/mod-nx').then(({ data: { data } }) => {
        // console.log(data)
        const result = {}
        this.deviceList = []
        for (let i = 0; i < data.length; i++) {
          const item = data[i]
          const title = item.title
          const aa = title.split('犀牛盾Mod')
          const device = aa[0].replace(' -', '').trim()
          if (!result[device]) {
            result[device] = {}
            this.deviceList.push(device)
          }
          if (aa[1].match(/\(([\d\D]+)\)/)) {
            let key = RegExp.$1
            if (key === '按鈕') {
              key = '按鍵'
            }
            result[device][key] = item
          } else {
            result[device]['透明背板'] = item
          }
        }
        this.selectDevice = this.deviceList[1]
        this.$set(this, 'deviceObject', result)
      })
      // TODO
      // Call API 抓取產品資料並依產品類型分類。
      // API URL : http://localhost:3000/mod-nx
    },

    addToCart () {
      // TODO
      // 把選取的產品加到 cartItems 裡面並 console 出來
      const deviceObject = this.deviceObject
      const selectDevice = this.selectDevice
      const phoneType = this.phoneType
      const phoneColorType = this.phoneColorType
      const backType = this.backType
      this.cartItems = []
      this.cartItems.push(deviceObject[selectDevice]['手機'].variants[phoneType])
      this.cartItems.push(deviceObject[selectDevice]['外框'].variants[phoneColorType])
      this.cartItems.push(deviceObject[selectDevice]['飾條'].variants[phoneColorType])
      this.cartItems.push(deviceObject[selectDevice]['按鍵'].variants[phoneColorType])
      this.cartItems.push(deviceObject[selectDevice]['背板'].variants[backType])

      console.log(this.cartItems)
    }
  }
}
</script>

<style lang="sass" scoped>
@font-face
  font-family: MarkPro-Bold
  src: url('https://cdn.shopify.com/s/files/1/0274/8717/files/MarkPro-Bold.otf?12401685184872946130')

@font-face
  font-family: NotoSansCJKtc-Bold
  src: url('https://cdn.shopify.com/s/files/1/0274/8717/files/NotoSansCJKtc-Bold.otf?12610878586689504297')

@font-face
  font-family: MarkPro
  src: url('https://cdn.shopify.com/s/files/1/0274/8717/files/MarkPro.otf?4269257120200746974')

@font-face
  font-family: NotoSansCJKtc-Regular
  src: url(https://cdn.shopify.com/s/files/1/0274/8717/files/NotoSansCJKtc-Regular.otf?4935245772218057441)

#purchase
  position: relative
  width: 100%
  height: 100%
  max-width: 1440px
  display: flex
  padding: 120px 60px
  align-items: flex-start
  justify-content: space-between
  box-sizing: border-box

.purchase__title-wrapper
  width: 25%
  max-width: 220px

.display__area
  height: 100%

.selection__area
  display: flex
  flex-direction: column
  justify-content: space-between
  align-self: stretch
  margin-left: 70px
  width: 35%
  max-width: 260px

  .device__selector
    margin-bottom: 25px

  .checkout

    &__detail
      font-family: 'MarkPro', 'NotoSansCJKtc-Regular'

      &__info
        margin: 15px 0
        padding: 0
        line-height: 14px
        font-size: 14px
        text-align: left

    &__button__block
      display: flex
      justify-content: space-between
      align-items: center
      font-family: 'MarkPro-Bold', 'NotoSansCJKtc-Bold'

      .price
        font-size: 14px
        text-algin: right

    &__btn
      display: flex
      justify-content: center
      align-items: center
      width: 100%
      height: 40px
      max-width: 180px
      color: #FFF
      // font-family: 'MarkPro-Bold', 'NotoSansCJKtc-Bold'
      box-shadow: none
      border: none
      border-radius: 20.5px
      background-color: #2D2D2D
      transition: all .3s ease
      white-space: inherit

  .outward
    border-top: 2px solid #D8D8D8

  .option__block
    position: relative
    display: flex
    justify-content: flex-start
    align-items: center
    padding: 20px 0
    border-bottom: 1px solid #D8D8D8

    .option__title
      font-size: 14px
      font-family: 'MarkPro', 'NotoSansCJKtc-Regular'
      color: #2D2D2D

    .icon
      position: absolute
      right: 0
      top: 50%
      width: 16px
      height: 16px
      transform: translateY(-50%)
      cursor: pointer

      &::before
        content: ''
        position: absolute
        left: 0
        width: 1px
        height: 16px
        background-color: #D8D8D8
        transform: rotate(90deg)
        transition: all .3s ease

      &::after
        content: ''
        position: absolute
        left: 0
        width: 1px
        height: 16px
        background-color: #D8D8D8
        transition: all .3s ease

    p
      margin: 0
      padding: 0

.purchase__preview
  position: relative
  margin: 0 auto
  width: 100%
  max-width: 650px
  height: 100%
  &-images-wrapper
    position: relative
    height: 80%
  &-image
    &.main
      position: relative
      height: 100%
      z-index: 2
    &.sub
      position: absolute
      height: 100%
      top: 0
      left: 0
    &--backward
      z-index: 1
      transition: all .3s
      transform: translate(12%,-10%)
    &.case
      z-index: 3
    &.backplate
      z-index: 2

.purchase__selector-wrapper
  &.phone
    position: absolute
    top: 50%
    left: 25%
    transform: translateY(-50%)
    z-index: 3

.purchase__backplate-switch-wrapper
  position: absolute
  top: 50px
  right: 0
  z-index: 3

.color-picker-title
  position: absolute
  top: 0
  right: 0
  margin: 0
  font-size: 12px
  color: #000
  line-height: normal
  text-transform: uppercase
  transform: translateY(-120%)
  opacity: .2

.color-picker--vertical
  display: flex
  align-items: center
  justify-content: flex-start
  flex-direction: column
  --desc-text-width: 150px
  --desc-dash-width: 16px
  --desc-dash-margin: 13px

  &.normal
    --border-color: #d5d5d5
    --hover-border: #d5d5d5
    --dash-color: #d8d8d8
    --font-color: #2d2d2d

  &__option
    position: relative
    width: 29px
    height: 29px
    border: 1px solid transparent
    border-radius: 50%
    z-index: 200
    transition: all .3s ease
    margin-bottom: 18px
    display: flex
    align-items: center
    justify-content: center
    &:hover
      border: 1px solid var(--hover-border)
    .active, .dot
      width: 23px
      height: 23px
    .dot
      border: 1px solid var(--border-color)
      border-radius: 50%
      cursor: pointer

.apple_graphite
  background-color: #686763

.silver
  background-color: #c9c8c9

.gold
  background-color: #fadcc2

.pacific_blue
  background-color: #43616c
</style>
